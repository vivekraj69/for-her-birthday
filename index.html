<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Happy Birthday Kaku</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;700&display=swap');

        :root {
            --bg: #ffe4e1;
            --pink: #ff6b96;
            --accent: #ff3b6b;
            --card: #fff;
            --muted: #f7d7e6;
            --glass: rgba(255, 255, 255, 0.06);
        }

        * {
            box-sizing: border-box;
            font-family: 'Dancing Script', cursive;
            touch-action: manipulation;
        }

        html, body {
            height: 100%;
            margin: 0;
            color: #111;
            overflow-x: hidden;
        }

        .hidden {
            display: none;
        }

        .center-full {
            height: 100vh;
            width: 100vw;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 12px;
        }

        #heading {
            position: fixed;
            top: 10px;
            width: 100%;
            text-align: center;
            font-size: 1.8em;
            color: var(--pink);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            z-index: 100;
        }

        .puppy-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            filter: brightness(0.95) blur(4px);
        }

        .puppy-sprite {
            position: absolute;
            transform: translate(-50%, -50%);
            pointer-events: none;
            opacity: 0.95;
        }

        @keyframes floatLR {
            0% { transform: translate(-50%, -50%) translateX(-20px); }
            50% { transform: translate(-50%, -50%) translateX(20px); }
            100% { transform: translate(-50%, -50%) translateX(-20px); }
        }

        .start-card {
            z-index: 12;
            background: linear-gradient(180deg, #fff0f4, #fff7fb);
            padding: 14px;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 4px solid rgba(0, 0, 0, 0.05);
            text-align: center;
            width: 90%;
            max-width: 360px;
        }

        .title {
            font-weight: 900;
            color: var(--accent);
            font-size: 24px;
            letter-spacing: 1px;
        }

        .subtitle {
            color: #6b3a48;
            margin-top: 4px;
            font-size: 14px;
        }

        .gift {
            width: 200px;
            height: 200px;
            border-radius: 12px;
            background: linear-gradient(180deg, #ffdede, #ff7b9b);
            margin: 12px auto;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            transition: transform 0.1s;
            z-index: 10;
        }

        .gift:active {
            transform: scale(0.95);
        }

        .ribbon {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff;
            padding: 6px 10px;
            border-radius: 8px;
            font-weight: 900;
            color: var(--accent);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            z-index: 11;
        }

        .gift::before, .gift::after {
            content: '';
            position: absolute;
            background: #ffd700;
            width: 100%;
            height: 16px;
            top: 50%;
            left: 0;
            transform: rotate(0deg);
            box-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            z-index: 11;
        }

        .gift::after {
            transform: rotate(90deg);
        }

        .lights {
            position: absolute;
            top: -8px;
            left: -8px;
            width: calc(100% + 16px);
            height: calc(100% + 16px);
            border-radius: 12px;
            box-shadow: 0 0 16px 4px #ff0, 0 0 32px 8px #f00, 0 0 48px 12px #0f0;
            animation: twinkle 1.5s infinite alternate;
            z-index: 11;
        }

        @keyframes twinkle {
            0% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .hint {
            font-size: 12px;
            color: #7a3a48;
            margin-top: 6px;
        }

        .love-line {
            position: absolute;
            font-size: 1em;
            color: var(--accent);
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.8);
            padding: 4px 8px;
            border-radius: 4px;
            animation: scatter 2s ease-out forwards, pulse 1s infinite alternate;
            white-space: nowrap; /* Prevent line breaks to keep full text visible */
            max-width: 90vw; /* Limit width to screen */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @keyframes scatter {
            0% {
                opacity: 0;
                transform: translate(0, 0) rotate(0deg) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(var(--translate-x), var(--translate-y)) rotate(var(--rotate)) scale(1);
            }
        }

        @keyframes pulse {
            0% { transform: translate(var(--translate-x), var(--translate-y)) rotate(var(--rotate)) scale(0.95); }
            100% { transform: translate(var(--translate-x), var(--translate-y)) rotate(var(--rotate)) scale(1.05); }
        }

        .cake-scene {
            display: none;
            z-index: 16;
            min-height: 100vh;
            width: 100vw;
            padding: 16px;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .cake-wrap {
            background: linear-gradient(180deg, #fff8fb, #fff0f6);
            border-radius: 12px;
            padding: 14px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .cake-area {
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .cake {
            width: 300px;
            position: relative;
            overflow: visible;
            cursor: pointer;
            transition: transform 0.15s;
        }

        .layer {
            width: 92%;
            border-radius: 50% / 20%;
            margin: 8px auto;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        }

        .layer.top {
            background: linear-gradient(180deg, #fff7f9, #fff0f6);
            height: 40px;
            width: 60%;
        }

        .layer.mid {
            background: linear-gradient(180deg, #ffe6f0, #ffd6e6);
            height: 60px;
            width: 80%;
        }

        .layer.bot {
            background: linear-gradient(180deg, #ffdce6, #ffcbe0);
            height: 80px;
            width: 100%;
        }

        .icing {
            position: absolute;
            left: 6px;
            right: 6px;
            top: -20px;
            height: 40px;
            background: linear-gradient(180deg, #fff3f6, #ffe6ee);
            border-radius: 24px;
            box-shadow: inset 0 4px 16px rgba(255, 200, 220, 0.1);
        }

        .sprinkles {
            position: absolute;
            left: 6px;
            right: 6px;
            top: -4px;
            height: 8px;
            display: flex;
            gap: 6px;
            justify-content: center;
        }

        .sprinkles span {
            width: 6px;
            height: 10px;
            border-radius: 3px;
            background: linear-gradient(180deg, #ff9fb3, #ff6b6b);
        }

        .flower {
            position: absolute;
            width: 16px;
            height: 16px;
            background: radial-gradient(circle, #ff69b4, #ff1493);
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(255, 105, 180, 0.5);
        }

        .flower1 { top: 40px; left: 40px; }
        .flower2 { top: 80px; right: 40px; }
        .flower3 { bottom: 40px; left: 80px; }

        .sparkle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: radial-gradient(circle, #fff, #ffd700);
            border-radius: 50%;
            animation: sparkle 1s infinite alternate;
        }

        .sparkle1 { top: 16px; left: 60px; }
        .sparkle2 { top: 90px; right: 60px; }
        .sparkle3 { bottom: 16px; left: 120px; }

        @keyframes sparkle {
            0% { transform: scale(0.8); opacity: 0.6; }
            100% { transform: scale(1.2); opacity: 1; }
        }

        .candles {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .candle {
            width: 8px;
            height: 28px;
            background: #fff;
            border-radius: 3px;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            position: relative;
        }

        .flame {
            width: 10px;
            height: 12px;
            border-radius: 50%;
            background: linear-gradient(180deg, #ffd36b, #ff7b3b);
            box-shadow: 0 4px 12px rgba(255, 110, 110, 0.3);
            margin-top: -6px;
            animation: flicker 0.3s infinite alternate;
        }

        @keyframes flicker {
            0% { transform: scale(1); opacity: 0.8; }
            100% { transform: scale(1.1); opacity: 1; }
        }

        .flame.buzzed {
            animation: buzh 0.5s forwards;
        }

        @keyframes buzh {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0); opacity: 0; }
        }

        .cake .lights {
            position: absolute;
            top: -16px;
            left: -16px;
            width: calc(100% + 32px);
            height: calc(100% + 32px);
            box-shadow: 0 0 16px 4px #ff0, 0 0 32px 8px #f00, 0 0 48px 12px #0f0;
            animation: twinkle 1.5s infinite alternate;
            border-radius: 50%;
        }

        .cake-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 36%;
            font-weight: 900;
            color: #a82a56;
            font-size: 16px;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .cake-note {
            margin-top: 8px;
            color: #9b2450;
            font-weight: 800;
            font-size: 14px;
        }

        .happy-birthday-text {
            position: absolute;
            font-size: 1.5em;
            color: var(--accent);
            font-weight: 900;
            text-shadow: 0 0 8px rgba(255, 107, 150, 0.8);
            opacity: 0;
            z-index: 9999;
            animation: popUp 2s ease-out forwards;
        }

        @keyframes popUp {
            0% { opacity: 0; transform: translateY(0) scale(0.5); }
            50% { opacity: 1; transform: translateY(-80px) scale(1.2); }
            100% { opacity: 0; transform: translateY(-120px) scale(1); }
        }

        #nextButton {
            display: none;
            position: fixed;
            bottom: 16px;
            right: 16px;
            padding: 8px 16px;
            background-color: var(--pink);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 100;
            font-size: 1em;
        }

        .gallery {
            display: none;
            z-index: 20;
            min-height: 100vh;
            width: 100vw;
            position: relative;
            overflow: hidden;
        }

        .gallery-bg {
            position: absolute;
            inset: 0;
            z-index: -1;
            background-size: cover;
            background-position: center;
            filter: blur(2px) brightness(0.45) contrast(0.92);
            transform: scale(1.03);
            transition: background-image 0.45s ease, opacity 0.45s ease;
        }

        .gallery-inner {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            gap: 0;
            z-index: 60;
        }

        .left-pane {
            width: 100%;
            height: 40%;
            background: transparent;
            padding: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: auto;
        }

        .right-pane {
            width: 100%;
            height: 60%;
            position: relative;
            background: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: pan-x;
        }

        #date {
            position: absolute;
            top: 12px;
            right: 12px;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--pink);
            z-index: 80;
        }

        .tree-wrap {
            width: 100%;
            height: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            gap: 8px;
        }

        .marquee-text {
            font-size: 1.5em;
            color: var(--accent);
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }

        marquee {
            overflow: visible;
        }

        .shayari-wrap {
            width: 90%;
            margin-top: 8px;
            padding: 6px;
            border-radius: 8px;
            background: linear-gradient(180deg, #fff, #fff7fb);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            height: fit-content;
            min-height: 16px;
        }

        .shayari-text {
            font-style: italic;
            color: #6b2b3a;
            font-size: 14px;
            line-height: 1.4;
        }

        .center-image-wrap {
            position: relative;
            z-index: 5;
            max-width: 90%;
            max-height: 90%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .center-image {
            max-width: 85%;
            max-height: 85%;
            border-radius: 10px;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5);
            border: 6px solid rgba(255, 255, 255, 0.06);
            object-fit: cover;
            transition: transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), rotate 0.5s cubic-bezier(0.25, 0.1, 0.25, 1);
            position: relative;
        }

        .center-image-wrap::before {
            content: '';
            position: absolute;
            top: -12px;
            left: -12px;
            width: calc(100% + 24px);
            height: calc(100% + 24px);
            border-radius: 14px;
            box-shadow: 0 0 16px 4px #ff0, 0 0 32px 8px #f00, 0 0 48px 12px #0f0, 0 0 64px 16px #ff69b4;
            animation: twinkle 1.5s infinite alternate;
            z-index: -1;
        }

        .nav-hint {
            position: absolute;
            left: 12px;
            top: 12px;
            color: #fff;
            z-index: 80;
            font-weight: 700;
            pointer-events: none;
            font-size: 12px;
        }

        .hearts-rain {
            position: absolute;
            inset: 0;
            z-index: 10;
            pointer-events: none;
        }

        .heart {
            position: absolute;
            width: 16px;
            height: 16px;
            background: red;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            animation: fall 5s linear infinite, sparkle 1s infinite alternate;
            opacity: 0.8;
        }

        @keyframes fall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        @keyframes sparkle {
            0% { box-shadow: 0 0 8px #fff; }
            100% { box-shadow: 0 0 16px #ff0; }
        }

        @media (min-width: 600px) {
            .start-card { max-width: 400px; }
            .gift { width: 220px; height: 220px; }
            .cake-wrap { max-width: 450px; }
            .cake { width: 340px; }
            .cake-area { height: 340px; }
            .left-pane { height: 45%; }
            .right-pane { height: 55%; }
            .marquee-text { font-size: 1.8em; }
            .shayari-text { font-size: 15px; }
        }
    </style>
</head>
<body>
    <div id="heading">Happy Birthday Kaku</div>
    <div id="puppyBg" class="puppy-bg" aria-hidden="true"></div>

    <div id="startScreen" class="center-full" style="z-index:12">
        <div class="start-card">
            <div class="title">Happy Birthday Kaku</div>
            <div class="subtitle">A special surprise awaits!</div>
            <div id="giftBtn" class="gift" title="Tap to open">
                <div class="ribbon">For Kaku</div>
                <div class="lights"></div>
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <rect x="3" y="6" width="18" height="12" rx="2" fill="#fff" stroke="#ff2f6f" stroke-width="0.6"/>
                    <path d="M3 10h18" stroke="#ff2f6f" stroke-width="1"/>
                </svg>
            </div>
            <div class="hint">Tap the gift to begin the surprise</div>
        </div>
    </div>

    <div id="cakeScene" class="cake-scene hidden" aria-hidden="true">
        <div class="cake-wrap" style="margin-top:12px">
            <div class="cake-area">
                <div id="cake" class="cake">
                    <div class="lights"></div>
                    <div class="icing"></div>
                    <div class="sprinkles">
                        <span></span><span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <div class="layer top"></div>
                    <div class="layer mid"></div>
                    <div class="layer bot"></div>
                    <div class="flower flower1"></div>
                    <div class="flower flower2"></div>
                    <div class="flower flower3"></div>
                    <div class="sparkle sparkle1"></div>
                    <div class="sparkle sparkle2"></div>
                    <div class="sparkle sparkle3"></div>
                    <div id="candles" class="candles"></div>
                    <div id="cakeTitle" class="cake-title">Happy Birthday Kaku ‚ù§</div>
                </div>
            </div>
            <div id="cakeNote" class="cake-note">Swipe the cake to cut it</div>
        </div>
        <button id="nextButton" onclick="openGalleryAuto()">Next</button>
    </div>

    <div id="gallery" class="gallery hidden" aria-hidden="true">
        <div class="gallery-bg"></div>
        <div id="date">17 September</div>
        <div class="gallery-inner">
            <aside class="left-pane" aria-label="left pane">
                <div class="tree-wrap">
                    <marquee behavior="alternate" direction="left" scrollamount="4" class="marquee-text">Happy Birthday ‚ù§</marquee>
                    <marquee behavior="alternate" direction="right" scrollamount="4" class="marquee-text">My Queen ‚ù§</marquee>
                </div>
                <div class="shayari-wrap" aria-live="polite">
                    <div id="shayari" class="shayari-text"></div>
                </div>
            </aside>
            <main class="right-pane" aria-label="image pane">
                <div class="nav-hint">Swipe to change images</div>
                <div class="center-image-wrap">
                    <img id="centerImg" class="center-image" src="" alt="current large"/>
                </div>
            </main>
        </div>
        <div class="hearts-rain" id="heartsRain"></div>
    </div>

    <audio id="bgAudio" loop preload="auto">
        <source src="songs/tum_ho.mp3" type="audio/mp3" />
    </audio>

    <script>
        const TOTAL = 55;
        const IMAGES = [];
        for (let i = 1; i <= TOTAL; i++) IMAGES.push(`images/${i}.jpg`);
        const SHAYARI = [
            "Teri muskurahat meri pehchaan hai, teri khushi mera armaan hai ‚ù§",
            "Har saans mein tera naam ho, har dua mein tera kaam ho üíñ",
            "Zindagi teri hamesha khushiyon se bhari rahe, Janamdin mubarak ho üåπ",
            "Tere bina adhoori hun main, tere saath hi poori kahani üíï",
            "Tere husn ki tareef kam pad jaaye, janamdin pe tu sabse khaas ho ‚ú®",
            "Tere liye likhi har dua sachi ho, tere sapne kabhi adhure na rahe üåü",
            "Har subah teri muskurahat se roshan ho, har raat teri khushiyon se pyari rahe üåô",
            "Teri awaaz mere liye sur hai, tera pyaar mere liye sabse anmol üé∂",
            "Tere sang har pal mera khazana hai, tu hi meri zindagi ka afsana üíû",
            "Meri duniya teri muskurahat se roshan, janamdin pe tu rahe sada khush üéâ",
            "Dil ki har dhadkan mein tera hi naam, tere liye ye pal khuda ka inaam ‚ù§",
            "Teri aankhon ke noor se jeeta hun main, teri khushi mein hi mera nivaas üíù",
            "Tu mile to har pal ka matlab badal gaya, janamdin tera sabse pyaara tyohar üå∏",
            "Tere bina adhoora hai ye safar, tera saath ho to milti har khushi ka asar üíñ",
            "Har mod pe tera saath ho, tere sapnon ko mil jaye aasman ka raasta ‚ú®",
            "Tere honthon pe muskan sada rahe, meri dua hai ye bas yahi ‚ù§",
            "Mere dil ki dhadkan tu, mere armaanon ka noor tu, janamdin mubarak ho üíó",
            "Jitni bhi khushiyan lu, kam pad jaaye tera pyaar ‚Äî happy birthday meri jaan üåπ",
            "Teri khushi mein hi meri khushi chhupi hai, tera har sapna poora ho yehi dua hai üéÇ",
            "Tere pyaar ne jeena sikhaya, janamdin pe tu mile khushiyon ka sahara üíï",
            "Tere liye meri har dua roshan rahe, tere sapne bulbule ki tarah phale üåü",
            "Tere honthon ki muskaan meri pehchaan, tu sada rahe yahaan ‚ù§",
            "Teri baaton mein khushbu si basi ho, tu hamesha rahe sada mastani üå∏",
            "Tere liye main duniya saja doon, tu ho to har manzil asaan hai üíñ",
            "Aaj ka din ho sirf tera, har pal tera naam lekar chalna üéâ",
            "Tere sapno ko mil jaaye pankh, tu udd jaaye aasman tak ‚ú®",
            "Tere liye likhi har nazm mein tera zikr ho, tere naam pe ye zindagi mili ‚ù§",
            "Teri yaadon ke sahare jeeta hun, tera haath tham ke chalna chahta hun üíû",
            "Har pal tera saath ho, har khushi teri rahe ‚Äî meri dua sada tumhare saath üåπ",
            "Teri aankhon ke noor ne ye raat roshan ki, janamdin tera ho roshni ki baarkat ‚ú®",
            "Aaj ka din ho tera, sab khushiyan tumko milen ‚Äî happy birthday üéÇ",
            "Teri hassi se hi meri duniya khil uthi, tujhe paa ke mili ye zindagi üíï",
            "Teri khushiyon se mehek uthe mera ghar, tera saath sada rahe mere yaar ‚ù§",
            "Tere sapnon ka raasta sada khula rahe, tera dil sada mehka rahe üå∏",
            "Tere liye kuch bhi kar jaaun, tu rahe khush to sab theek hai üíñ",
            "Tere honthon pe rahe sada muskan, tera janamdin bane yaadon ka jashn üéâ",
            "Bas tu saath rahe, bas tu hi bane ‚Äî meri duniya ka sabse pyara ehsaas ‚ù§",
            "Teri ek jhalak se dil beqaraar hai, tera janamdin meri zindagi ka tyohar hai üåü",
            "Tere pyaar ka rang chhaya hai, har pal tera saath dil ko sukoon de jaya hai üíï",
            "Tu hai toh har raah roshan hai, tera janamdin meri zindagi ka jashn hai üéÇ",
            "Tere bina ye dil adhura sa lage, tera saath hi meri duniya ko sajaye üåπ",
            "Teri muskan se har gham bhul jaye, tera janamdin dil se dil tak jaye ‚ù§",
            "Tere liye chand sitare bhi kam hain, tu hai toh meri duniya ke sabse anmol nazaare hain ‚ú®",
            "Teri har baat dil ko chhoo jaye, tera janamdin har pal yaadgaar banaye üíñ",
            "Tu meri wajah hai har khushi ki, tera saath hai meri zindagi ki roshni üåü",
            "Tere pyaar mein dooba hai ye dil, janamdin pe tujhe mile khushiyan hazaar üéâ",
            "Teri aankhon mein basi hai meri duniya, tera janamdin hai meri khushi ka jariya ‚ù§",
            "Tere saath har pal ek kahani hai, tera janamdin meri zindagi ki rani hai üíï",
            "Teri hansi se roshan hai ye jahan, tera janamdin hai mera pyara armaan üåπ",
            "Tu hai meri duaon ka asar, tera saath hai meri zindagi ka safar ‚ú®",
            "Tere liye likha hai ye dil ka paigam, tera janamdin ho sabse khaas inaam ‚ù§",
            "Teri muskurahat se hai meri duniya roshan, tera janamdin hai meri khushi ka jashn üéÇ",
            "Tere bina har pal suna hai, tera saath meri zindagi ka guna hai üíñ",
            "Teri har ada pe dil kurbaan hai, tera janamdin meri zindagi ka imaan hai üåü",
            "Tu hai toh har khushi meri hai, tera janamdin meri zindagi ki jannat hai üéâ"
        ];

        const puppyBg = document.getElementById('puppyBg');
        const startScreen = document.getElementById('startScreen');
        const giftBtn = document.getElementById('giftBtn');
        const cakeScene = document.getElementById('cakeScene');
        const cake = document.getElementById('cake');
        const candles = document.getElementById('candles');
        const cakeTitle = document.getElementById('cakeTitle');
        const cakeNote = document.getElementById('cakeNote');
        const nextButton = document.getElementById('nextButton');
        const gallery = document.getElementById('gallery');
        const galleryBg = document.querySelector('.gallery-bg');
        const shayariEl = document.getElementById('shayari');
        const centerImg = document.getElementById('centerImg');
        const bgAudio = document.getElementById('bgAudio');
        const heartsRain = document.getElementById('heartsRain');

        let currentIndex = 0;
        let cakeCut = false;

        function spawnBgPuppies(n = 8) {
            try {
                puppyBg.innerHTML = '';
                for (let i = 0; i < n; i++) {
                    const el = document.createElement('div');
                    el.className = 'puppy-sprite';
                    const x = Math.random() * 100, y = Math.random() * 100;
                    const size = 32 + Math.random() * 60;
                    el.style.left = `${x}vw`;
                    el.style.top = `${y}vh`;
                    el.style.width = `${size}px`;
                    el.style.height = `${size}px`;
                    el.style.animation = `floatLR ${6 + Math.random() * 6}s ease-in-out ${Math.random() * 2}s infinite`;
                    el.innerHTML = `<svg viewBox="0 0 200 200" width="${Math.round(size * 0.85)}" height="${Math.round(size * 0.85)}"><g transform="translate(18,8)"><ellipse cx="40" cy="48" rx="12" ry="16" fill="#d9a8a8"/><ellipse cx="120" cy="48" rx="12" ry="16" fill="#d9a8a8"/><ellipse cx="80" cy="78" rx="38" ry="36" fill="#fff"/><circle cx="64" cy="72" r="6" fill="#222"/><circle cx="96" cy="72" r="6" fill="#222"/></g></svg>`;
                    puppyBg.appendChild(el);
                }
            } catch (e) {
                console.error('Error in spawnBgPuppies:', e);
            }
        }
        spawnBgPuppies(8);

        giftBtn.addEventListener('click', () => {
            try {
                console.log('Gift button tapped');
                const lines = [
                    "My dearest Kaku, on this special day, will you be my forever? ‚ù§",
                    "May your life be filled with endless joy and love! üíñ",
                    "You are my world, Happy Birthday, my queen! üåπ",
                    "All your dreams come true, with blessings! ‚ú®"
                ];
                const giftRect = giftBtn.getBoundingClientRect();
                const screenWidth = window.innerWidth;
                const screenHeight = window.innerHeight;
                lines.forEach((text, index) => {
                    const line = document.createElement('div');
                    line.className = 'love-line';
                    line.textContent = text;
                    line.style.top = `${giftRect.top + giftRect.height / 2}px`;
                    line.style.left = `${giftRect.left + giftRect.width / 2}px`;
                    let tx, ty;
                    const maxOffset = Math.min(screenWidth / 3, 120); // Reduced range for fit
                    const minY = 50; // Top margin
                    const maxY = screenHeight - 100; // Bottom margin
                    if (index === 0) { // Top-left
                        tx = -Math.random() * maxOffset - 40;
                        ty = -Math.random() * maxOffset - 30;
                    } else if (index === 1) { // Top-right
                        tx = Math.random() * maxOffset + 40;
                        ty = -Math.random() * maxOffset - 30;
                    } else if (index === 2) { // Bottom-left
                        tx = -Math.random() * maxOffset - 40;
                        ty = Math.random() * maxOffset + 30;
                    } else { // Bottom-right
                        tx = Math.random() * maxOffset + 40;
                        ty = Math.random() * maxOffset + 30;
                    }
                    // Clamp to screen bounds
                    ty = Math.max(minY - giftRect.top, Math.min(ty, maxY - giftRect.top));
                    tx = Math.max(20 - giftRect.left, Math.min(tx, screenWidth - 20 - giftRect.left));
                    line.style.setProperty('--translate-x', `${tx}px`);
                    line.style.setProperty('--translate-y', `${ty}px`);
                    line.style.setProperty('--rotate', `${(Math.random() - 0.5) * 30}deg`); // Reduced rotation for fit
                    line.style.animationDelay = `${index * 0.3}s`;
                    document.body.appendChild(line);
                    setTimeout(() => line.remove(), 8000);
                });
                setTimeout(() => {
                    console.log('Transitioning to cake scene');
                    startScreen.style.display = 'none';
                    cakeScene.classList.remove('hidden');
                    cakeScene.style.display = 'flex';
                    cakeScene.scrollIntoView({ behavior: 'smooth' });
                    setupCake();
                    bgAudio.play().catch(() => console.log('Audio autoplay blocked'));
                }, 8000);
            } catch (e) {
                console.error('Error in giftBtn click:', e);
            }
        });

        function setupCake() {
            try {
                console.log('Setting up cake');
                candles.innerHTML = '';
                for (let i = 0; i < 7; i++) {
                    const c = document.createElement('div');
                    c.className = 'candle';
                    c.innerHTML = `<div class="flame"></div>`;
                    candles.appendChild(c);
                }
                cakeCut = false;
                attachCakeHandlers();
            } catch (e) {
                console.error('Error in setupCake:', e);
            }
        }

        let cakeBound = false;
        function attachCakeHandlers() {
            if (cakeBound) return;
            cakeBound = true;
            let down = false, startX = 0, moved = 0;
            try {
                cake.addEventListener('touchstart', (e) => {
                    if (cakeCut) return;
                    down = true;
                    startX = e.touches[0].clientX;
                    moved = 0;
                    cake.style.transition = 'transform 0.06s';
                    cake.style.transform = 'scale(0.995)';
                });
                window.addEventListener('touchmove', (e) => {
                    if (!down || cakeCut) return;
                    moved = e.touches[0].clientX - startX;
                    cake.style.transform = `translateX(${moved * 0.45}px) scale(0.995)`;
                });
                window.addEventListener('touchend', () => {
                    if (!down || cakeCut) return;
                    down = false;
                    cake.style.transform = '';
                    if (Math.abs(moved) > 80) {
                        finishCakeCut();
                    } else {
                        const prev = cakeNote.textContent;
                        cakeNote.textContent = 'Swipe harder to cut!';
                        setTimeout(() => { if (!cakeCut) cakeNote.textContent = prev; }, 1000);
                    }
                });
                cake.addEventListener('click', () => { if (!cakeCut) finishCakeCut(); });
            } catch (e) {
                console.error('Error in attachCakeHandlers:', e);
            }
        }

        function finishCakeCut() {
            if (cakeCut) return;
            cakeCut = true;
            try {
                console.log('Cutting cake');
                const fs = candles.querySelectorAll('.flame');
                fs.forEach(f => {
                    f.classList.add('buzzed');
                });
                const rect = cake.getBoundingClientRect();
                const left = cake.cloneNode(true);
                const right = cake.cloneNode(true);
                [left, right].forEach(el => {
                    el.style.position = 'fixed';
                    el.style.left = `${rect.left}px`;
                    el.style.top = `${rect.top}px`;
                    el.style.width = `${rect.width}px`;
                    el.style.height = `${rect.height}px`;
                    el.style.margin = 0;
                    el.style.zIndex = 9998;
                    document.body.appendChild(el);
                });
                left.style.clip = `rect(0px, ${rect.width / 2}px, ${rect.height}px, 0px)`;
                right.style.clip = `rect(0px, ${rect.width}px, ${rect.height}px, ${rect.width / 2}px)`;
                left.animate([
                    { transform: 'translateX(0) rotate(0)' },
                    { transform: `translateX(-${rect.width / 2 + 40}px) rotate(-10deg)` }
                ], { duration: 800, easing: 'cubic-bezier(.2,.9,.3,1)' });
                right.animate([
                    { transform: 'translateX(0) rotate(0)' },
                    { transform: `translateX(${rect.width / 2 + 40}px) rotate(10deg)` }
                ], { duration: 800, easing: 'cubic-bezier(.2,.9,.3,1)' });

                const birthdayText = document.createElement('div');
                birthdayText.className = 'happy-birthday-text';
                birthdayText.textContent = 'Happy Birthday To You! üéâ';
                birthdayText.style.left = `${rect.left + rect.width / 2}px`;
                birthdayText.style.top = `${rect.top + rect.height / 2}px`;
                document.body.appendChild(birthdayText);
                setTimeout(() => birthdayText.remove(), 1800);

                triggerConfetti(200);
                setTimeout(() => {
                    left.remove();
                    right.remove();
                    nextButton.style.display = 'block';
                }, 1800);
            } catch (e) {
                console.error('Error in finishCakeCut:', e);
            }
        }

        function triggerConfetti(n = 120) {
            try {
                console.log('Triggering confetti');
                const cvs = document.createElement('canvas');
                cvs.style.position = 'fixed';
                cvs.style.left = 0;
                cvs.style.top = 0;
                cvs.style.zIndex = 9999;
                cvs.style.pointerEvents = 'none';
                document.body.appendChild(cvs);
                const ctx = cvs.getContext('2d');
                function resize() {
                    cvs.width = window.innerWidth;
                    cvs.height = window.innerHeight;
                }
                resize();
                window.addEventListener('resize', resize);
                const pieces = [];
                const colors = ['#ff6b96', '#ffd36b', '#6b8cff', '#6bff9e', '#ff9fb3', '#c699ff'];
                for (let i = 0; i < n; i++) {
                    pieces.push({
                        x: window.innerWidth / 2 + (Math.random() - 0.5) * 200,
                        y: window.innerHeight / 2 + (Math.random() - 0.5) * 60,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() * -10) - 5,
                        r: Math.random() * 6 + 3,
                        color: colors[Math.floor(Math.random() * colors.length)],
                        rot: Math.random() * 360,
                        vr: (Math.random() - 0.5) * 8,
                        life: 180 + Math.random() * 100
                    });
                }
                function step() {
                    ctx.clearRect(0, 0, cvs.width, cvs.height);
                    for (let i = pieces.length - 1; i >= 0; i--) {
                        const p = pieces[i];
                        p.x += p.vx;
                        p.y += p.vy;
                        p.vy += 0.4;
                        p.rot += p.vr;
                        p.life--;
                        ctx.save();
                        ctx.translate(p.x, p.y);
                        ctx.rotate(p.rot * Math.PI / 180);
                        ctx.fillStyle = p.color;
                        ctx.fillRect(-p.r / 2, -p.r / 2, p.r, p.r * 0.6);
                        ctx.restore();
                        if (p.life < 0 || p.y > window.innerHeight + 150) pieces.splice(i, 1);
                    }
                    if (pieces.length) requestAnimationFrame(step);
                    else {
                        ctx.clearRect(0, 0, cvs.width, cvs.height);
                        cvs.remove();
                    }
                }
                requestAnimationFrame(step);
            } catch (e) {
                console.error('Error in triggerConfetti:', e);
            }
        }

        function openGalleryAuto() {
            try {
                console.log('Opening gallery');
                cakeScene.style.display = 'none';
                gallery.classList.remove('hidden');
                gallery.style.display = 'flex';
                currentIndex = 0;
                applyBackground(currentIndex);
                setCenterImage(currentIndex);
                startTypewriter(currentIndex);
                preloadImages();
                attachGalleryInteractions();
                bgAudio.play().catch(() => console.log('Audio autoplay blocked'));
                startHeartsRain();
            } catch (e) {
                console.error('Error in openGalleryAuto:', e);
            }
        }

        function applyBackground(i) {
            try {
                const prevIndex = (i - 1 + TOTAL) % TOTAL;
                galleryBg.style.backgroundImage = `url('${IMAGES[prevIndex] || 'https://via.placeholder.com/800'}')`;
            } catch (e) {
                console.error('Error in applyBackground:', e);
            }
        }

        function setCenterImage(i) {
            try {
                centerImg.src = IMAGES[i] || 'https://via.placeholder.com/800';
            } catch (e) {
                console.error('Error in setCenterImage:', e);
            }
        }

        function preloadImages() {
            try {
                IMAGES.forEach(src => { const img = new Image(); img.src = src; });
            } catch (e) {
                console.error('Error in preloadImages:', e);
            }
        }

        let typeTimer = null;
        function startTypewriter(i) {
            try {
                if (typeTimer) { clearInterval(typeTimer); typeTimer = null; }
                const text = SHAYARI[i % SHAYARI.length] || "Happy Birthday Kaku ‚ù§";
                shayariEl.textContent = '';
                let idx = 0;
                typeTimer = setInterval(() => {
                    idx++;
                    shayariEl.textContent = text.slice(0, idx);
                    if (idx >= text.length) { clearInterval(typeTimer); typeTimer = null; }
                }, 30);
            } catch (e) {
                console.error('Error in startTypewriter:', e);
            }
        }

        let touchActive = false, touchStartX = 0, touchDelta = 0, lastTouchX = 0;
        let animationFrameId = null;
        function attachGalleryInteractions() {
            try {
                const target = document.querySelector('.right-pane');
                target.addEventListener('touchstart', (e) => {
                    if (animationFrameId) cancelAnimationFrame(animationFrameId);
                    touchActive = true;
                    touchStartX = e.touches[0].clientX;
                    lastTouchX = touchStartX;
                    touchDelta = 0;
                    centerImg.style.transition = 'none';
                });
                target.addEventListener('touchmove', (e) => {
                    if (!touchActive) return;
                    const currentX = e.touches[0].clientX;
                    touchDelta = currentX - touchStartX;
                    lastTouchX = currentX;
                    if (animationFrameId) cancelAnimationFrame(animationFrameId);
                    animationFrameId = requestAnimationFrame(() => {
                        const mx = Math.max(-120, Math.min(120, touchDelta));
                        const rot = mx / 10; // Slight rotation based on drag
                        centerImg.style.transform = `translateX(${mx}px) scale(0.98) rotate(${rot}deg)`;
                        centerImg.style.opacity = Math.max(0.6, 1 - Math.abs(mx) / 150);
                    });
                });
                target.addEventListener('touchend', () => {
                    if (!touchActive) return;
                    touchActive = false;
                    if (animationFrameId) cancelAnimationFrame(animationFrameId);
                    if (Math.abs(touchDelta) > 50) {
                        const direction = touchDelta < 0 ? -1 : 1;
                        centerImg.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                        centerImg.style.transform = `translateX(${direction * 100}%) scale(0.98) rotate(${direction * 5}deg)`;
                        centerImg.style.opacity = 0;
                        setTimeout(() => {
                            if (direction < 0) nextImage();
                            else prevImage();
                        }, 400);
                    } else {
                        centerImg.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                        centerImg.style.transform = 'translateX(0) scale(1) rotate(0deg)';
                        centerImg.style.opacity = 1;
                    }
                });
                target.addEventListener('touchcancel', () => {
                    touchActive = false;
                    if (animationFrameId) cancelAnimationFrame(animationFrameId);
                    centerImg.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                    centerImg.style.transform = 'translateX(0) scale(1) rotate(0deg)';
                    centerImg.style.opacity = 1;
                });
            } catch (e) {
                console.error('Error in attachGalleryInteractions:', e);
            }
        }

        function setIndex(i) {
            try {
                const newIndex = ((i % TOTAL) + TOTAL) % TOTAL;
                applyBackground(newIndex);
                const direction = i > currentIndex ? 1 : -1;
                centerImg.style.transition = 'none';
                centerImg.style.transform = `translateX(${direction * 30}%) scale(0.98) rotate(${direction * 3}deg)`;
                centerImg.style.opacity = 0;
                setTimeout(() => {
                    centerImg.src = IMAGES[newIndex] || 'https://via.placeholder.com/800';
                    centerImg.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1), opacity 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                    centerImg.style.transform = 'translateX(0) scale(1) rotate(0deg)';
                    centerImg.style.opacity = 1;
                    currentIndex = newIndex;
                    startTypewriter(currentIndex);
                }, 50);
            } catch (e) {
                console.error('Error in setIndex:', e);
            }
        }

        function nextImage() { setIndex(currentIndex + 1); }
        function prevImage() { setIndex(currentIndex - 1); }

        function startHeartsRain() {
            try {
                for (let i = 0; i < 40; i++) {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.style.left = `${Math.random() * 100}vw`;
                    heart.style.animationDelay = `${Math.random() * 5}s`;
                    heart.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
                    heartsRain.appendChild(heart);
                }
            } catch (e) {
                console.error('Error in startHeartsRain:', e);
            }
        }

        document.body.addEventListener('click', function once() {
            try {
                bgAudio.play().catch(() => console.log('Audio autoplay blocked'));
                document.body.removeEventListener('click', once);
            } catch (e) {
                console.error('Error in initial audio play:', e);
            }
        }, { once: true });
    </script>
</body>
</html>
